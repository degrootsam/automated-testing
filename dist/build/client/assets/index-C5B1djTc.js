import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{B as E}from"./index-DMsUvaHI.js";import{B as u,C as L}from"./index-uFqOPUMb.js";import{H as A}from"./index-ZxjzPnyj.js";import{T as H}from"./index-Bre9T0-e.js";import{T as R}from"./index-wfZIODoR.js";import{T as P}from"./index-CouqIJUX.js";import{r as a,b as j,d as z,a as O,L as N}from"./components-DAwjMhVV.js";import{g as D,j as b,f as $}from"./index-CokscfNF.js";import{A as G}from"./index-D3e8Zo9y.js";import{M as C}from"./index-BmP81L1w.js";import{i as g}from"./index-BhvR20cr.js";import{i as U,B as V,a as W,C as q,r as I}from"./index-DEkoM-wp.js";import"./iconBase-ViZ73mvc.js";function Q({dependency:r,project:x,showModal:c,onSuccess:o,onHideModal:l}){const i=a.useRef(null),t=j({key:"delete-test"}),m=f=>{f.preventDefault(),i.current&&t.submit(i.current,{method:"POST",action:`/api/projects/${x.name}/setup/delete`})},p=a.useCallback(()=>{if(t.data){if(g(t.data))return;l&&l(),o(),t.data=void 0}},[l,o,t]);return a.useEffect(()=>{p()},[p]),e.jsxs(C,{showModal:c,onHideModal:l,title:"Are you sure?",buttons:[{children:e.jsxs(e.Fragment,{children:[e.jsx(D,{}),"Confirm"]}),color:"error",onClick:m,loading:t.state!=="idle"}],children:[e.jsxs("p",{className:"text-sm",children:["Are you sure you want to delete dependency ",e.jsx("b",{children:r}),"?"]}),g(t.data)&&e.jsx(G,{message:t.data.error.message,className:"mt-2",color:"error"}),e.jsx(t.Form,{ref:i,children:e.jsx("input",{type:"hidden",name:"setup",value:r})})]})}function J(r){return e.jsx(C,{...r,title:"Help: Dependencies",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:"What are dependencies?"}),e.jsx("p",{className:"text-sm",children:"Dependencies are simply “pre-tests” you record once and then re-run automatically whenever you run or record a suite. By turning common setup flows (like logging in) into dependencies, you avoid repeating them in every test."})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:"Nested dependencies"}),e.jsx("p",{className:"text-sm",children:"Each dependency can itself depend on other tests, forming a dependency tree. For example, you might have a User Login dependency which in turn depends on Admin Login."})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:"Parallel vs. Chained Execution"}),e.jsx("p",{className:"text-sm",children:"By default, all dependencies of a suite run in parallel—they start at the same time. If you need a true “step 1 → step 2 → step 3” setup (a chained flow), give each setup test its own dependency."})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-bold",children:"Example: "}),e.jsxs("ul",{children:[e.jsx("li",{children:"Create Admin Login"}),e.jsx("li",{children:"Create User Login and set it to depend on Admin Login"})]}),e.jsx("p",{children:"That way, you get:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Reusability: record your login flow once, reuse everywhere"}),e.jsx("li",{children:"Flexibility: spin up multiple setups in parallel for speed, or chain them for strict order"})]})]})]})})}const ce=()=>[{rel:"stylesheet",href:I}];function oe(){const{project:r}=z(),{suite:{name:x,dependencyGraph:c,dependencyTree:o,currentDependencies:l,availableDependencies:i}}=O(),[t,m]=a.useState(!1),p=()=>{m(!0)},f=()=>{m(!1)},T=j({key:"update-deps"}),h=j(),k=d=>{const{dataset:s}=d.currentTarget,n=s.dependency;n&&T.submit({dependency:n},{method:"POST"})};a.useEffect(()=>{if(h.data){if(g(h.data))return;h.load("./")}},[h.data]);const y=d=>d.map((s,n)=>e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{className:"flex flex-row gap-4 items-center p-4",children:[e.jsx(R,{checked:l.includes(s.name),"data-dependency":s.name,onChange:k}),e.jsx("p",{className:"font-bold text-sm",children:s.name}),e.jsx(E,{color:s.metadata.type==="suite"?"primary":"secondary",size:"sm",children:s.metadata.type})]}),e.jsx(u,{square:!0,"data-name":s.name,type:"button",className:"active:bg-error",onClick:B,children:e.jsx(D,{})})]}),e.jsx("div",{className:"ml-4 bg-base-300 shadow-inner flex flex-row items-center",children:y(s.dependencies)})]},`${s.name}-${n}`)),[M,v]=a.useState(!1),[F,S]=a.useState(""),B=d=>{const{dataset:s}=d.currentTarget,n=s.name;n&&(S(n),v(!0))},w=()=>{v(!1)};return e.jsxs("div",{className:"grid gap-4",children:[e.jsx(J,{showModal:t,onHideModal:f}),e.jsx(Q,{showModal:M,onHideModal:w,onSuccess:w,project:r,dependency:F}),e.jsxs("div",{className:"flex flex-row items-center justify-between",children:[e.jsx(A,{size:"h1",children:"Suite Configuration"}),e.jsxs("div",{className:"flex flex-row gap-2",children:[e.jsx(N,{to:"../view",children:e.jsx(u,{children:"Go back"})}),e.jsxs(u,{onClick:p,children:[e.jsx(b,{}),"Help"]})]})]}),e.jsx(L,{children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm",children:e.jsx("b",{children:"Name"})}),e.jsx(H,{className:"w-full",placeholder:"name",name:"suite",value:x,disabled:!0})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[e.jsx("p",{className:"text-sm",children:e.jsx("b",{children:"Dependencies"})}),e.jsx(P,{message:"Dependencies are tests that are executed (in parallel) before each test or recording.",children:e.jsx(b,{className:"opacity-30"})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-4 min-h-64",children:[e.jsx("div",{className:"col-span-8 h-full",children:e.jsxs("div",{className:"w-full h-full shadow-lg rounded-lg p-4",children:[e.jsxs("div",{className:"flex flex-row items-center justify-between",children:[e.jsxs("p",{className:"text-xs text-neutral opacity-60",children:[i.length||0," available"," ",i.length>0?"dependencies":"dependency"," ","found"]}),e.jsx(N,{to:"create-setup",children:e.jsxs(u,{color:"primary",children:[e.jsx($,{})," Create"]})})]}),y(o)]})}),e.jsx("div",{className:"col-span-4 bg-base-200 rounded-lg",children:e.jsxs(U,{fitView:!0,nodes:c.nodes,edges:c.edges,children:[e.jsx(V,{color:"#ccc",size:2,variant:W.Dots}),e.jsx(q,{})]})})]})]})]})})]})}export{oe as default,ce as links};
